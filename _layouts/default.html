<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - Matlock Fight Talk{% else %}Matlock Fight Talk{% endif %}</title>
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
    <table width="100%" border="1" cellspacing="0" cellpadding="10" bgcolor="#000000" bordercolor="#FF0000">
        <tr>
            <td colspan="2" align="center">
                <img src="/assets/under_construction.gif" alt="Under Construction" width="200" height="100">
                <h1><blink>MATLOCK</blink></h1>
                <marquee behavior="scroll" direction="left" scrollamount="5"><font color="#CC0000">WELCOME TO THE END OF THE INTERNET</font></marquee>
            </td>
        </tr>
        <tr>
            <td width="20%" valign="top" bgcolor="#000000">
                <h2>Navigation</h2>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/fighttalk">Fight Talk!</a></li>
                    <li><a href="/vegas">Vegas Slots</a></li>
                    <li><a href="/chatroom">Chatroom</a></li>
                    <li><a href="/guestbook">Guestbook</a></li>
                </ul>
                <hr>
                <center><img src="/assets/fist.gif" alt="Fist Icon" width="100" height="100"></center>
                <hr>
                <center>
                    <div id="audio-player">
                        <p><font color="#FF0000"><blink>Click to unleash fight tunes!</blink></font></p>
                        <div class="audio-container">
                            <audio id="player">
                                <source src="/assets/facethepain.mp3" type="audio/mpeg">
                                <source src="/assets/Original.mp3" type="audio/mpeg">
                                <source src="/assets/DeathorGlory.mp3" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                            <div class="audio-controls">
                                <img src="/assets/play.gif" alt="Play" onclick="playAudio()" class="control-button">
                                <img src="/assets/pause.gif" alt="Pause" onclick="pauseAudio()" class="control-button">
                                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" onchange="setVolume()">
                            </div>
                            <select id="song-selector" onchange="changeSong()">
                                <option value="/assets/facethepain.mp3">Face The Pain</option>
                                <option value="/assets/Original.mp3">O.G.</option>
                                <option value="/assets/DeathorGlory.mp3">Death or Glory</option>
                            </select>
                        </div>
                        <script>
                            var player = document.getElementById('player');
                            function playAudio() {
                                player.src = document.getElementById('song-selector').value;
                                player.play();
                            }
                            function pauseAudio() {
                                player.pause();
                            }
                            function changeSong() {
                                player.src = document.getElementById('song-selector').value;
                                player.play();
                            }
                            function setVolume() {
                                player.volume = document.getElementById('volume-slider').value;
                            }
                        </script>
                    </div>
                </center>
                <hr>
                <center>
                    <!-- Debug: Log page URL -->
                    <script>
                        console.log('Current page URL:', '{{ page.url }}');
                    </script>
                    {% if page.url contains "chatroom" %}
                    <div id="chat-container" class="chat-container">
                        <div id="chat-login">
                            <input type="text" id="chat-username" placeholder="Enter Username">
                            <button id="chat-login-button">Join Cage</button>
                        </div>
                        <div id="chat-input-area" style="display: none;">
                            <div id="chat-messages"></div>
                            <input type="text" id="chat-input" placeholder="Type your fight talk...">
                            <button id="chat-send-button">Send</button>
                        </div>
                    </div>
                    <script>
                        // Initialize Firebase
                        const firebaseConfig = {
                            apiKey: "AIzaSyBhM9yPLtn7YDa9Ulx6gzqY1G58ywTy5xM",
                            authDomain: "matlockfighttalk.firebaseapp.com",
                            databaseURL: "https://matlockfighttalk-default-rtdb.firebaseio.com",
                            projectId: "matlockfighttalk",
                            storageBucket: "matlockfighttalk.firebasestorage.app",
                            messagingSenderId: "520477465023",
                            appId: "1:520477465023:web:db53e9987bc0b4b96ee90a"
                        };
                        try {
                            firebase.initializeApp(firebaseConfig);
                            console.log('Firebase initialized successfully');
                        } catch (error) {
                            console.error('Firebase initialization error:', error);
                        }
                        const database = firebase.database();

                        document.addEventListener('DOMContentLoaded', () => {
                            console.log('DOM loaded, initializing chat');
                            const chatMessages = document.getElementById('chat-messages');
                            const chatInput = document.getElementById('chat-input');
                            const chatSendButton = document.getElementById('chat-send-button');
                            const chatUsername = document.getElementById('chat-username');
                            const chatLoginButton = document.getElementById('chat-login-button');
                            let username = '';

                            if (!chatMessages || !chatInput || !chatSendButton || !chatUsername || !chatLoginButton) {
                                console.error('Chat elements not found:', {
                                    chatMessages: !!chatMessages,
                                    chatInput: !!chatInput,
                                    chatSendButton: !!chatSendButton,
                                    chatUsername: !!chatUsername,
                                    chatLoginButton: !!chatLoginButton
                                });
                                return;
                            }

                            // Load messages from Firebase
                            const messagesRef = database.ref('chatroom/messages');
                            messagesRef.limitToLast(50).on('child_added', (snapshot) => {
                                const data = snapshot.val();
                                const messageElement = document.createElement('div');
                                messageElement.textContent = `${data.username}: ${data.message}`;
                                chatMessages.appendChild(messageElement);
                                chatMessages.scrollTop = chatMessages.scrollHeight;
                            }, (error) => {
                                console.error('Firebase message load error:', error);
                            });

                            chatLoginButton.addEventListener('click', () => {
                                if (chatUsername.value.trim()) {
                                    username = chatUsername.value.trim();
                                    document.getElementById('chat-login').style.display = 'none';
                                    document.getElementById('chat-input-area').style.display = 'block';
                                    messagesRef.push({
                                        username: 'System',
                                        message: `${username} entered the cage!`,
                                        timestamp: Date.now()
                                    }).catch((error) => {
                                        console.error('Firebase push error:', error);
                                    });
                                }
                            });

                            chatSendButton.addEventListener('click', () => {
                                if (chatInput.value.trim() && username) {
                                    messagesRef.push({
                                        username: username,
                                        message: chatInput.value.trim(),
                                        timestamp: Date.now()
                                    }).catch((error) => {
                                        console.error('Firebase push error:', error);
                                    });
                                    chatInput.value = '';
                                }
                            });

                            chatInput.addEventListener('keypress', (e) => {
                                if (e.key === 'Enter' && chatInput.value.trim() && username) {
                                    messagesRef.push({
                                        username: username,
                                        message: chatInput.value.trim(),
                                        timestamp: Date.now()
                                    }).catch((error) => {
                                        console.error('Firebase push error:', error);
                                    });
                                    chatInput.value = '';
                                }
                            });
                        });
                    </script>
                    {% endif %}
                </center>
                <hr>
                <center>
                    <a href="https://aol.sentrybay.com/deploy/aol.php?licensor=netscape&uid=mbr_rusdeflnk00000002&ncid=mbr_rusdeflnk00000002">
                        <img src="/assets/netscape.gif" alt="Get Netscape Now!" width="88" height="31">
                    </a>
                </center>
            </td>
            <td width="80%" valign="top">
                {{ content }}
            </td>
        </tr>
        <tr>
            <td colspan="2" align="center" bgcolor="#333333">
                <font color="#FFFFFF">Copyright © 2025 MATLOCK'S FIGHT TALK. All rights reserved. | Visitor count: <img src="/assets/counter.gif" alt="Hit Counter"></font>
                <br>
                <marquee behavior="alternate"><font color="#FF0000">Powered by Secret Juice</font></marquee>
            </td>
        </tr>
    </table>
</body>
</html>
